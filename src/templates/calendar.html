<style>
  #cal-toolbar{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
  #uie-calendar-window button,
  #uie-calendar-window input,
  #uie-calendar-window textarea{ border-radius:6px !important; }
  #uie-calendar-window{ backdrop-filter: blur(8px); }
  #cal-modal-card{ border-radius:8px !important; }
  @media (max-width: 700px), (pointer: coarse) {
    #cal-toolbar{ gap:8px; }
    #cal-toolbar button{ height:32px !important; width:38px !important; border-radius:6px !important; }
    #cal-toolbar #cal-title{ font-size:14px; }
  }
  #uie-calendar-window{ position: fixed; top: 80px; left: 80px; transform:none; isolation:isolate; }
  @media (max-width: 700px), (pointer: coarse) {
    #uie-calendar-window {
      position: fixed !important;
      inset: auto !important;
      top: 12vh !important;
      left: 3vw !important;
      transform: none !important;
      width: 94vw !important;
      height: 80vh !important;
      max-width: 94vw !important;
      max-height: 80vh !important;
    }
  }
</style>
<div id="uie-calendar-window" class="uie-window" style="display:none; width:min(860px, 92vw); height:min(840px, 92vh); background:rgba(0,0,0,0.78); backdrop-filter: blur(8px); flex-direction:column; border:1px solid rgba(203,163,92,0.45);">
    <div class="uie-header" style="border-bottom: 1px solid rgba(255,255,255,0.12); padding: 10px; background: linear-gradient(90deg, rgba(241,196,15,0.12), rgba(0,0,0,0.0));">
        <div id="cal-window-title" style="font-family:serif; color:#cba35c; letter-spacing:1px; font-size: 24px; font-weight: bold;">CALENDAR</div>
        <div class="uie-controls">
            <button id="cal-menu-btn" title="Menu" style="height:34px; width:44px; border-radius:12px; border:1px solid rgba(255,255,255,0.12); background:rgba(255,255,255,0.06); color:#fff; font-weight:900;"><i class="fa-solid fa-sparkles"></i></button>
            <button id="cal-close-btn" class="uie-close-btn" title="Close" style="height:34px; width:44px; border-radius:12px; border:1px solid rgba(255,255,255,0.12); background:rgba(255,255,255,0.06); color:#fff; font-weight:900;"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div id="cal-menu-dropdown" style="display:none;position:absolute;top:50px;right:12px;background:rgba(15,10,8,0.98);border:1px solid rgba(255,255,255,0.15);border-radius:12px;padding:8px;z-index:2147483650;flex-direction:column;gap:4px;width:180px;box-shadow:0 4px 12px rgba(0,0,0,0.5);">
            <button id="cal-today-btn" class="cal-drop-item"><i class="fa-solid fa-calendar-day"></i> Today</button>
            <button id="cal-help-btn" class="cal-drop-item" onclick="uie.phone.openBooksGuide('guide-calendar')"><i class="fa-solid fa-circle-question"></i> Help / Guide</button>
            <button id="cal-rp-open-btn" class="cal-drop-item"><i class="fa-solid fa-clock-rotate-left"></i> RP Date Settings</button>
            <button id="cal-refresh-btn" class="cal-drop-item"><i class="fa-solid fa-rotate-right"></i> Sync Time</button>
            <button id="cal-add-btn" class="cal-drop-item"><i class="fa-solid fa-calendar-plus"></i> Add Event</button>
            <button id="cal-sparkle-gen-btn" class="cal-drop-item"><i class="fa-solid fa-wand-magic-sparkles"></i> AI Generate</button>
            <button id="cal-import-btn" class="cal-drop-item"><i class="fa-solid fa-file-import"></i> Import</button>
            <button id="cal-export-btn" class="cal-drop-item"><i class="fa-solid fa-file-export"></i> Export</button>
        </div>
    </div>
    <div id="cal-subtitle" style="padding:0 10px; font-size:0.75em; color:#aaa;">Timezone: <span id="cal-tz">In-world</span></div>

  <style>
    .cal-drop-item {
        display: flex;
        align-items: center;
        gap: 10px;
        width: 100%;
        background: transparent;
        border: none;
        color: #fff;
        padding: 10px;
        border-radius: 8px;
        cursor: pointer;
        text-align: left;
        font-weight: 600;
        font-size: 14px;
    }
    .cal-drop-item:hover {
        background: rgba(255,255,255,0.1);
    }
    .cal-drop-item i {
        width: 20px;
        text-align: center;
        opacity: 0.8;
    }
    @media (max-width: 700px) {
        #cal-window-title { font-size: 18px !important; }
        .uie-header { padding: 8px !important; }
        #cal-month-title { font-size: 16px !important; }
    }
  </style>

    <div style="flex:1; display:flex; flex-direction:column; min-height:0;">
        <div id="cal-toolbar" style="padding:12px; border-bottom:1px solid rgba(255,255,255,0.10);">
            <button id="cal-prev" style="height:34px; width:40px; border-radius:12px; border:1px solid rgba(255,255,255,0.12); background:rgba(0,0,0,0.25); color:#fff; font-weight:900;"><i class="fa-solid fa-chevron-left"></i></button>
            <div style="flex:1; min-width:0;">
                <div id="cal-month-title" style="font-weight:900; letter-spacing:0.5px; color:#fff;"></div>
                <div style="opacity:0.7; font-size:12px; color:#ddd;">Click a day to view/add events.</div>
            </div>
            <button id="cal-next" style="height:34px; width:40px; border-radius:12px; border:1px solid rgba(255,255,255,0.12); background:rgba(0,0,0,0.25); color:#fff; font-weight:900;"><i class="fa-solid fa-chevron-right"></i></button>
        </div>
        <input type="file" id="cal-import-file" accept=".json" style="display:none;">
        <div style="padding:10px 12px; border-bottom:1px solid rgba(255,255,255,0.08); display:grid; grid-template-columns: repeat(7, 1fr); gap:8px; font-size:11px; opacity:0.75; font-weight:900; color:#fff;">
            <div style="text-align:center;">Sun</div><div style="text-align:center;">Mon</div><div style="text-align:center;">Tue</div><div style="text-align:center;">Wed</div><div style="text-align:center;">Thu</div><div style="text-align:center;">Fri</div><div style="text-align:center;">Sat</div>
        </div>
        <div id="cal-grid" style="padding:10px 12px; display:grid; grid-template-columns: repeat(7, 1fr); gap:8px; flex:1; overflow:auto;"></div>
    </div>
</div>

<div id="cal-modal" style="display:none; position:absolute; inset:0; z-index:2147483651; background:rgba(0,0,0,0.75);">
    <div id="cal-modal-card" style="position:absolute; width:min(520px, 92vw); max-height:70vh; overflow:auto; border-radius:16px; border:1px solid rgba(255,255,255,0.12); background:rgba(15,10,8,0.96); padding:12px; color:#fff;">
        <div style="display:flex; gap:10px; align-items:center;">
            <div style="font-weight:900;" id="cal-modal-title">Date</div>
            <button id="cal-modal-close" style="margin-left:auto; height:34px; padding:0 10px; border-radius:12px; border:1px solid rgba(255,255,255,0.12); background:rgba(0,0,0,0.25); color:#fff; font-weight:900;">Close</button>
        </div>
        <div id="cal-modal-list" style="margin-top:10px; display:flex; flex-direction:column; gap:8px;"></div>
        <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
            <input id="cal-new-title" type="text" placeholder="Event title..." style="flex:1; height:40px; border-radius:14px; border:1px solid rgba(255,255,255,0.12); background:rgba(0,0,0,0.25); color:#fff; padding:0 12px;">
            <input id="cal-new-time" type="text" placeholder="Time (optional)" style="width:140px; height:40px; border-radius:14px; border:1px solid rgba(255,255,255,0.12); background:rgba(0,0,0,0.25); color:#fff; padding:0 12px;">
            <button id="cal-add" style="height:40px; padding:0 14px; border-radius:14px; border:none; background:#2ecc71; color:#000; font-weight:900;">Add</button>
        </div>
        <textarea id="cal-new-notes" placeholder="Notes (optional)..." style="margin-top:8px; width:100%; height:90px; border-radius:14px; border:1px solid rgba(255,255,255,0.12); background:rgba(0,0,0,0.25); color:#fff; padding:10px 12px; resize:vertical;"></textarea>
    </div>
</div>

<div id="cal-rp-modal" style="display:none; position:fixed; inset:0; z-index:2147483651; background:rgba(0,0,0,0.75);">
    <div id="cal-rp-card" style="position:absolute; width:min(520px, 92vw); max-height:70vh; overflow:auto; border-radius:16px; border:1px solid rgba(255,255,255,0.12); background:rgba(15,10,8,0.96); padding:12px; color:#fff;">
        <div style="display:flex; gap:10px; align-items:center;">
            <div style="font-weight:900;">RP DATE</div>
            <button id="cal-rp-modal-close" style="margin-left:auto; height:34px; padding:0 10px; border-radius:12px; border:1px solid rgba(255,255,255,0.12); background:rgba(0,0,0,0.25); color:#fff; font-weight:900;">Close</button>
        </div>
        <div style="margin-top:10px; display:flex; flex-direction:column; gap:10px;">
            <label style="display:flex; gap:10px; align-items:center; font-size:12px; color:#ddd; font-weight:900;">
                <input id="cal-use-rp-date" type="checkbox">
                Use RP date (override real date)
            </label>
            <input id="cal-rp-date" type="text" placeholder="YYYY-MM-DD (example: 2230-01-01)" style="height:40px; border-radius:14px; border:1px solid rgba(255,255,255,0.12); background:rgba(0,0,0,0.25); color:#fff; padding:0 12px;">
            <div style="display:flex; gap:8px; flex-wrap:wrap;">
                <button id="cal-rp-set" style="height:40px; padding:0 14px; border-radius:14px; border:none; background:#2ecc71; color:#000; font-weight:900;">Set</button>
                <button id="cal-rp-prev-day" style="height:40px; padding:0 14px; border-radius:14px; border:1px solid rgba(255,255,255,0.12); background:rgba(0,0,0,0.25); color:#fff; font-weight:900;">-1</button>
                <button id="cal-rp-next-day" style="height:40px; padding:0 14px; border-radius:14px; border:1px solid rgba(255,255,255,0.12); background:rgba(0,0,0,0.25); color:#fff; font-weight:900;">+1</button>
                <button id="cal-rp-next-week" style="height:40px; padding:0 14px; border-radius:14px; border:1px solid rgba(255,255,255,0.12); background:rgba(0,0,0,0.25); color:#fff; font-weight:900;">+7</button>
                <button id="cal-rp-today" style="height:40px; padding:0 14px; border-radius:14px; border:1px solid rgba(255,255,255,0.12); background:rgba(0,0,0,0.25); color:#fff; font-weight:900;">Now</button>
            </div>
            <div style="opacity:0.75; font-size:12px;">When enabled, the calendar highlights and AI date reasoning use the RP date instead of real time.</div>
        </div>
    </div>
</div>
