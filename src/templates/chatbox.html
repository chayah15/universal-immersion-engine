<style>
  #uie-chatbox-window{
    position: fixed !important;
    right: 20px !important;
    bottom: 20px !important;
    left: auto !important;
    top: auto !important;
    transform: none !important;
    width: min(450px, 90vw) !important;
    height: min(600px, 75vh) !important;
    border-radius: 20px !important;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5) !important;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    z-index: 9999 !important;
    font-family: sans-serif;
  }
  @media (max-width: 700px), (pointer: coarse) {
    #uie-chatbox-window{
      right: 0 !important;
      left: 0 !important;
      bottom: 0 !important;
      width: 100vw !important;
      height: 60vh !important;
      border-radius: 20px 20px 0 0 !important;
    }
  }
</style>

<div id="uie-chatbox-window" class="uie-window" style="display:none; background:rgba(16, 20, 26, 0.95); backdrop-filter: blur(12px); border:1px solid rgba(255,255,255,0.1);">
  
  <!-- Header -->
  <div class="uie-header" style="padding: 12px 16px; border-bottom:1px solid rgba(255,255,255,0.05); display:flex; align-items:center; justify-content:space-between; background:rgba(255,255,255,0.02);">
    <div class="uie-info">
      <h2 style="margin:0; font-size:16px; font-weight:800; color:#eee; letter-spacing:0.5px;">CHATBOX</h2>
    </div>
    <div class="uie-controls" style="display:flex; gap:8px; align-items:center;">
      <select id="uie-chatbox-theme" style="height:28px; border-radius:8px; border:1px solid rgba(255,255,255,0.1); background:rgba(0,0,0,0.3); color:#ccc; font-size:12px; padding:0 8px; outline:none;">
        <option value="visual_novel">Visual Novel</option>
        <option value="rpg">RPG</option>
        <option value="magic_shop">Magic Shop</option>
        <option value="classroom">Classroom</option>
      </select>
      <button id="uie-chatbox-gear" title="Options" style="height:28px; width:28px; border-radius:8px; border:1px solid rgba(255,255,255,0.1); background:rgba(0,0,0,0.3); color:#ccc; cursor:pointer; display:grid; place-items:center;"><i class="fa-solid fa-gear" style="font-size:14px;"></i></button>
      <button id="uie-chatbox-close" title="Close" style="height:28px; width:28px; border-radius:8px; border:1px solid rgba(255,255,255,0.1); background:rgba(255,100,100,0.1); color:#ffaaaa; cursor:pointer; display:grid; place-items:center;"><i class="fa-solid fa-xmark" style="font-size:16px;"></i></button>
    </div>
  </div>

  <!-- Content Area -->
  <div style="display:flex; flex-direction:column; min-height:0; flex:1; position:relative;">
    
    <!-- Top Bar (Search & Tools) -->
    <div id="uie-chatbox-topbar" style="padding:8px 12px; display:flex; gap:8px; align-items:center;">
      <div style="position:relative; flex:1;">
        <input id="uie-chatbox-search" type="text" placeholder="Search..." style="width:100%; height:32px; border-radius:16px; border:1px solid rgba(255,255,255,0.08); background:rgba(0,0,0,0.2); color:#fff; padding:0 30px 0 12px; font-size:13px; outline:none;">
        <button id="uie-chatbox-search-clear" style="position:absolute; right:4px; top:4px; height:24px; width:24px; border:none; background:none; color:#aaa; cursor:pointer; font-size:16px; display:flex; align-items:center; justify-content:center;">Ã—</button>
      </div>
      <div style="display:flex; gap:4px;">
        <button id="uie-chatbox-open-inv" title="Inventory" style="height:32px; width:32px; border-radius:10px; border:none; background:rgba(255,255,255,0.05); color:#f1c40f; cursor:pointer;"><i class="fa-solid fa-box-open"></i></button>
        <button id="uie-chatbox-open-map" title="Map" style="height:32px; width:32px; border-radius:10px; border:none; background:rgba(255,255,255,0.05); color:#3498db; cursor:pointer;"><i class="fa-solid fa-map"></i></button>
      </div>
    </div>

    <div id="uie-chatbox-banner" style="display:none; padding:8px 12px; background:rgba(231,76,60,0.15); color:#ffb4aa; font-size:12px; text-align:center;"></div>

    <!-- Message List -->
    <div id="uie-chatbox-list" class="custom-scroll" style="flex:1; min-height:0; overflow-y:auto; overflow-x:hidden; padding:12px 16px;"></div>

    <!-- Composer Area -->
    <div id="uie-chatbox-composer-wrap" style="padding:12px; background:rgba(0,0,0,0.2); border-top:1px solid rgba(255,255,255,0.05);">
      <div id="uie-chatbox-composer" style="display:flex; flex-direction:column; gap:8px;"></div>
    </div>
  </div>

  <!-- Options Overlay -->
  <div id="uie-chatbox-options" style="display:none; position:absolute; inset:0; background:rgba(0,0,0,0.6); backdrop-filter:blur(5px); z-index:100; align-items:center; justify-content:center; padding:20px;">
    <div style="width:100%; max-width:350px; background:#1b202b; border:1px solid #333; border-radius:16px; padding:20px; color:#fff; box-shadow:0 20px 50px rgba(0,0,0,0.5);">
      <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
        <h3 style="margin:0; font-size:16px;">Chatbox Settings</h3>
        <button id="uie-chatbox-options-close" style="background:none; border:none; color:#888; cursor:pointer; font-size:18px;"><i class="fa-solid fa-xmark"></i></button>
      </div>

      <div style="margin-bottom:15px;">
        <label style="display:block; font-size:12px; color:#888; margin-bottom:6px;">Text Size</label>
        <input id="uie-chatbox-textscale" type="range" min="0.85" max="1.35" step="0.01" style="width:100%;">
      </div>

      <div style="margin-bottom:15px;">
        <label style="display:flex; align-items:center; gap:10px; cursor:pointer;">
          <input id="uie-chatbox-contrast" type="checkbox">
          <span style="font-size:14px;">High Contrast Mode</span>
        </label>
      </div>

      <div style="margin-bottom:20px;">
        <label style="display:block; font-size:12px; color:#888; margin-bottom:6px;">Background Image URL</label>
        <input id="uie-chatbox-bg" type="text" placeholder="https://..." style="width:100%; padding:8px; border-radius:8px; border:1px solid #333; background:#111; color:#fff; font-size:12px;">
      </div>

      <div style="display:flex; gap:10px;">
        <button id="uie-chatbox-options-save" style="flex:1; padding:10px; border-radius:8px; border:none; background:#cd7f32; color:#000; font-weight:bold; cursor:pointer;">Save</button>
        <button id="uie-chatbox-options-reset" style="flex:1; padding:10px; border-radius:8px; border:1px solid #333; background:transparent; color:#ccc; cursor:pointer;">Reset</button>
      </div>
    </div>
  </div>
</div>
